<!DOCTYPE html>
<html lang="en" dir="ltr" prefix="og: https://ogp.me/ns#">
  <head>
    <meta charset="utf-8" />
<link rel="canonical" href="https://mortenson.coffee/blog/introducing-twig-components" />
<meta name="description" content="Last week I published the Twig Components Drupal module - the latest in a series of projects aiming to combine Twig, Web Components, and PHP. I wanted to write about why I’m doing this work, and why developers should care." />
<meta property="og:site_name" content="Samuel Mortenson" />
<meta property="og:url" content="https://mortenson.coffee/blog/introducing-twig-components" />
<meta property="og:title" content="Introducing Twig Components" />
<meta property="og:description" content="Last week I published the Twig Components Drupal module - the latest in a series of projects aiming to combine Twig, Web Components, and PHP. I wanted to write about why I’m doing this work, and why developers should care." />
<meta property="article:tag" content="drupal" />
<meta property="article:tag" content="twig" />
<meta property="article:tag" content="frontend" />
<meta property="article:published_time" content="2018-04-09T16:03:24+00:00" />
<meta property="article:modified_time" content="2020-01-27T17:47:58+00:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@mortensonsam" />
<meta name="twitter:title" content="Introducing Twig Components" />
<meta name="twitter:creator" content="@mortensonsam" />
<meta name="twitter:url" content="https://mortenson.coffee/blog/introducing-twig-components" />
<meta name="Generator" content="Drupal 9 (https://www.drupal.org)" />
<meta name="MobileOptimized" content="width" />
<meta name="HandheldFriendly" content="true" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="shortcut icon" href="/themes/custom/mortenson/favicon.png" type="image/png" />
<link rel="revision" href="https://mortenson.coffee/blog/introducing-twig-components" />

    <link rel="alternate" type="application/rss+xml" title="RSS Feed" href="https://mortenson.coffee/feed.xml" />
    <title>Introducing Twig Components | Samuel Mortenson</title>
    <link rel="stylesheet" media="all" href="/sites/default/files/css/css_4opVjP04bsrP-JoEFfvUYsZpYfkLWu4DF8lGN3zgXxc.css" />
<link rel="stylesheet" media="all" href="/sites/default/files/css/css_aB2y-NhDKnlxBV1Cet-J9ahL-zIUh26rTpZB5aGZKSk.css" />

    
  </head>
  <body>
    <a href="#main-content" class="visually-hidden focusable">
      Skip to main content
    </a>
    
      <div class="dialog-off-canvas-main-canvas" data-off-canvas-main-canvas>
      <header class="mc-header container ">
          <a href="/blog" class="mc-header__back">Back to blog</a>
              <a href="/" class="mc-header__name">
            Samuel<br />Mortenson
          </a>
          </header><main id="main-content">
    <div>
    <div data-drupal-messages-fallback class="hidden"></div>  <article class="mc-blog container container--margin" role="article">
        <div class="mc-blog-title container">
    <div class="mc-blog-title__bg"></div>
    <h1 class="mc-blog-title__title">Introducing Twig Components</h1>
  </div>    <div class="mc-blog__byline">
      Apr 9th, 2018
    </div>
    <div class="mc-blog__text">
      
            <div><p>Last week I published the <a href="https://www.drupal.org/project/twig_components">Twig Components Drupal module</a> - the latest in a series of projects aiming to combine Twig, Web Components, and PHP. I wanted to write about why I’m doing this work, and why developers should care.</p>
<h2 id="web-components---a-time-and-place">Web Components - a Time and Place</h2>
<p><a href="https://github.com/w3c/webcomponents">Web Components</a> are a series of new W3C standards that allows Javascript to define custom HTML tags. These custom tags, known as <a href="https://developer.mozilla.org/en-US/docs/Web/Web_Components/Using_custom_elements">custom elements</a>, differ from the tags that web frameworks provide because no runtime is required to use them - the browser is aware of all custom elements and knows how to use them.</p>
<p>It’s important to note here that using web standards and “vanilla” Javascript has no inherit technical value, it’s just really exciting to be a part of something that’s new and framework agnostic. Betting on Web Components is betting on web standards, not <em>against</em> any other frontend tool.</p>
<p>That aside aside, the coolest part of custom elements to me is that they move a lot <em>back</em> to the DOM. The API for custom elements is HTML, you use them the same way you would use any other tag. Asking “Why custom elements” is like asking “Why &lt;input&gt;?”. If a custom element is useful, use it!</p>
<p>In my view, Web Components are a great fit for template-heavy CMSes. Frontend developers are probably already writing HTML templates/CSS/JS, so if anything Web Components are just a way to codify what you already do. This is not a revolutionary technology, but I think it’s something that bridges the very real gap between traditional CMSes and fully-fledged frontend frameworks.</p>
<p>I would also say that, at least out of the box, Web Components are not as ambitious as frontend frameworks, and do not aim to solve the same problems. Web Components don’t come with a solution for routing, state, or context, but what they do solve is componentizing HTML/CSS/JS in something that acts like any other native element. It’s worth nothing that people <em>have</em> built entire web applications with Web Components, but I don’t think that’s the <a href="https://en.wikipedia.org/wiki/Pareto_principle">80% use case</a>.</p>
<h2 id="discovering-universal-twig">Discovering Universal Twig</h2>
<p>If you’re a Symfony or Drupal 8 developer, you probably have seen or used Twig, a PHP template engine designed to be fast and flexible. I like writing Twig, and from what I can tell most of the Drupal community does as well. Some like it so much that they’ve created massive Atomic Design based themes that already include dozens of re-usable, componentized Twig templates.</p>
<p>I knew going into Web Components that I wanted to use Twig on the backend and the frontend - both for my own preference and to ease PHP developers into this uncharted territory.</p>
<p>Luckily for me, some generous folks had already ported Twig to Javascript with the appropriately named <a href="https://github.com/twigjs/twig.js">Twig.js</a> project. This opened the door for me to write <a href="https://www.npmjs.com/package/twig-components">Twig Components, an NPM project</a> that provided a base vanilla Web Component that knew how to handle Twig. I later created <a href="https://github.com/mortenson/twig-components-example">an example project</a> and a <a href="https://github.com/mortenson/generator-twig-components-webpack">project template</a> that included polyfills, test coverage, template pre-compiling and ES5 transpiler.</p>
<p>All the Javascript was coming into place, but I realized somewhere down the line that I could feasibly pre-compile these Web Components server-side with PHP. Normally for something like this you would use <a href="https://github.com/phpv8/v8js">V8JS</a>, which allows you to execute Javascript in PHP, but most hosting providers don’t have this extension installed and asking users to compile an extension to use Twig Components seemed like a bad developer experience. In practice I’ve also noticed that because V8JS isn’t exactly like the Node environment, it can be unruly to get things running.</p>
<p>So I set out to server-side render Web Components in PHP, and it turned out pretty well. My Composer project, <a href="https://github.com/mortenson/twig-components-ssr">mortenson/twig-components-ssr</a>, now supports nested components, &lt;style&gt; tags in templates, and the &lt;slot&gt; element. At this point, I felt like I could push forward on a Drupal integration.</p>
<h2 id="the-end-of-the-funnel">The end of the funnel</h2>
<p>Making Twig Components work in Drupal was always the end goal, and I knew that for the integration to work I had to make a module that provided more value than just getting the right Javascript on the page.</p>
<p>The first thing I added to the module is a new plugin annotation for components, which could be used in a class or a YML file. Using the plugin system was a little tough, but worth it since it gave me discoverability, cacheability, and extensibility. I based a ton of the code and tests on the Layout component and Layout Discovery module from Drupal core, so it may look eerily familiar.</p>
<p>Once plugins were in place, I started working on an event subscriber that responds to every HTML response in Drupal, pre-renders all components, and ensures that only the minimally required libraries are present on the page. You can <a href="https://www.drupal.org/docs/8/modules/twig-components/the-twig-component-render-pipeline">read the documentation for the renderer</a> for more details.</p>
<p>With a way for modules and themes to provide Twig Components, and assurance that server-side rendering and dynamic library addition works, I released the module on Drupal.org.</p>
<p>At this point, I just need users to create <em>real</em> things with it before I know what direction to take with the module. If anyone is interested in diving in and trying this out, you can <a href="https://www.drupal.org/docs/8/modules/twig-components/building-your-first-twig-component">jump into the documentation on Drupal.org here</a>.</p>
<p>Enjoy!</p>
</div>
      
    </div>
  </article>

  </div>

</main>
  <footer class="mc-footer container">
    <ul class="mc-footer__menu">
      <li><a href="/search">Search</a></li>
      <li><a href="/blog">Blog</a></li>
      <li><a href="/work">Work</a></li>
      <li><a href="/gallery">Gallery</a></li>
      <li><a href="mailto:samuel@mortenson.coffee">Contact</a></li>
    </ul>
    <div class="mc-footer__copyright">©2021 Samuel Mortenson</div>
    <a class="mc-footer__rss" href="/feed.xml">
      <span class="visually-hidden">RSS Feed</span>
      <img alt="RSS feed icon" src="/core/misc/feed.svg" />
    </a>
  </footer>
  </div>

    
    
  </body>
</html>
