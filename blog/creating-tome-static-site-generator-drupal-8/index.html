<!DOCTYPE html>
<html lang="en" dir="ltr" prefix="og: https://ogp.me/ns#">
  <head>
    <meta charset="utf-8" />
<link rel="canonical" href="https://mortenson.coffee/blog/creating-tome-static-site-generator-drupal-8" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="og:site_name" content="Samuel Mortenson" />
<meta name="twitter:title" content="Creating Tome, a static site generator for Drupal 8" />
<meta name="twitter:site" content="@mortensonsam" />
<meta name="description" content="Six months ago I started work on¬†Tome, a static site generator for Drupal 8. After lots of rewrites and long nights, Tome has finally reached the beta phase of testing and development! üéä
Up until now, I haven‚Äôt invested a lot of time in communicating what I‚Äôm doing, why I made Tome, or why static Drupal is hard, so now seems like a good time to stop and reflect on things before I write more code." />
<meta property="og:url" content="https://mortenson.coffee/blog/creating-tome-static-site-generator-drupal-8" />
<meta name="twitter:creator" content="@mortensonsam" />
<meta property="og:title" content="Creating Tome, a static site generator for Drupal 8" />
<meta name="twitter:url" content="https://mortenson.coffee/blog/creating-tome-static-site-generator-drupal-8" />
<meta property="og:description" content="Six months ago I started work on¬†Tome, a static site generator for Drupal 8. After lots of rewrites and long nights, Tome has finally reached the beta phase of testing and development! üéä
Up until now, I haven‚Äôt invested a lot of time in communicating what I‚Äôm doing, why I made Tome, or why static Drupal is hard, so now seems like a good time to stop and reflect on things before I write more code." />
<meta property="article:tag" content="drupal" />
<meta property="article:tag" content="tome" />
<meta property="article:tag" content="static site" />
<meta property="article:published_time" content="2018-11-29T16:08:19+00:00" />
<meta property="article:modified_time" content="2020-01-27T17:47:29+00:00" />
<meta name="Generator" content="Drupal 9 (https://www.drupal.org)" />
<meta name="MobileOptimized" content="width" />
<meta name="HandheldFriendly" content="true" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="shortcut icon" href="/themes/custom/mortenson/favicon.png" type="image/png" />
<link rel="revision" href="https://mortenson.coffee/blog/creating-tome-static-site-generator-drupal-8" />

    <link rel="alternate" type="application/rss+xml" title="RSS Feed" href="https://mortenson.coffee/feed.xml" />
    <title>Creating Tome, a static site generator for Drupal 8 | Samuel Mortenson</title>
    <link rel="stylesheet" media="all" href="/sites/default/files/css/css_RuEjmPT5dJhxGZtbhmaKQMs0spdvgqcE0CXbmvdbK94.css" />
<link rel="stylesheet" media="all" href="/sites/default/files/css/css_aB2y-NhDKnlxBV1Cet-J9ahL-zIUh26rTpZB5aGZKSk.css" />

    
  </head>
  <body>
    <a href="#main-content" class="visually-hidden focusable">
      Skip to main content
    </a>
    
      <div class="dialog-off-canvas-main-canvas" data-off-canvas-main-canvas>
      <header class="mc-header container ">
          <a href="/blog" class="mc-header__back">Back to blog</a>
              <a href="/" class="mc-header__name">
            Samuel<br />Mortenson
          </a>
          </header><main id="main-content">
    <div>
    <div data-drupal-messages-fallback class="hidden"></div>  <article class="mc-blog container container--margin" role="article">
        <div class="mc-blog-title container">
    <div class="mc-blog-title__bg"></div>
    <h1 class="mc-blog-title__title">Creating Tome, a static site generator for Drupal 8</h1>
  </div>    <div class="mc-blog__byline">
      Nov 29th, 2018
    </div>
    <div class="mc-blog__text">
      
            <div><p>Six months ago I started work on¬†<a href="https://tome.fyi/">Tome</a>, a static site generator for Drupal 8. After lots of rewrites and long nights, Tome has finally reached the beta phase of testing and development! üéä</p>
<p>Up until now, I haven‚Äôt invested a lot of time in communicating what I‚Äôm doing, why I made Tome, or why static Drupal is hard, so now seems like a good time to stop and reflect on things before I write more code.</p>
<h2 id="in-the-beginning-there-was-html">In the beginning, there was HTML.</h2>
<p>For the unaware, static sites serve files to clients with no dynamic content. That means that when a user visits a static homepage, they‚Äôre just being served an ‚Äúindex.html‚Äù file. If you‚Äôve ever had to write HTML files from scratch, this might sound like a step backwards. But don‚Äôt fret! This is where static site generators come in - they‚Äôre tools that use a structured data source to generate a site, no Dreamweaver required. The end result is still HTML, but the way we build static sites now is much cleaner than it used to be.</p>
<p>The tech behind static site generators has come a long way, but it‚Äôs still odd to see them gain traction in an era where it‚Äôs easier than ever to create a dynamic web page. I think this is a result of fatigue over hosting complexity, site updates, and performance problems. Consider what it takes to host a large scale dynamic site today - the stack isn‚Äôt trivial for individuals to set up anymore. Even if hosting is figured out, you still have to rush to get security updates on production, and need a site that can quickly respond to uncached requests. For sites that could function with no or very little dynamic behavior, static hosting is becoming an attractive alternative.</p>
<h2 id="finding-my-niche">Finding my niche.</h2>
<p>Before building Tome I was using static site generators like Jekyll and GatsbyJS, but still really liked Drupal 8 - the APIs, theme layer, structured content - it felt like I would lose so much by moving out of the ecosystem.</p>
<p>So I started thinking - for all of the ambitious, dynamic, authenticated Drupal sites out there, how many Drupal sites could function statically? As I looked around, I started to feel more and more confident that static Drupal is a viable alternative to the traditional stack. Even for sites that looked complex, most of the interactive parts of the page were anonymous forms and search, which can both be done statically. I had convinced myself, this is a problem worth tackling!</p>
<p>I think that most sane people at this point would start by making a faster version of¬†<code class=" hljs sql">wget <span class="hljs-comment">--recursive</span></code>, but I wasn‚Äôt satisfied with just handling static HTML. I wanted to generate¬†<em>static content</em>¬†too.</p>
<h2 id="whats-static-content">What‚Äôs static content?</h2>
<p>Most other static site generators build from a file-based source like a Markdown file, and I needed to do something similar for Tome. If you could build your Drupal site from scratch, you would never need a persistent Drupal stack running, not even on your local machine. Just edit content locally, commit your changes to git, turn off the Drupals, and spin it all back up when you need to.</p>
<p>After awhile, I realized that the closest thing we have to this in Drupal 8 is the configuration API. Many sites already stage configuration changes in version control in a similar way to how features worked in Drupal 7. This way they can ‚Äúcheck in‚Äù changes they make locally in development and have a consistent way to get changes on production. What if you could do this for content?</p>
<p>With configuration in mind, I started making a content exporter and importer system that automatically syncs all content changes to local JSON files, and allows users to rebuild their entire Drupal site from scratch. If you edit an Article locally when using Drupal, that change already shows up in Git and is ready for commit.</p>
<p>This gives users a completely new way to manage their content. With Git, many workflows that are hard to accomplish normally become trivial. Need content staging? Make a branch. Need to revert to an older version of your site? Checkout an old commit and rebuild. Have multiple editors? Give each a fork and only allow editors to accepts merge requests.</p>
<p>Beyond the content workflows introduced here, it also means that you don‚Äôt need to run Drupal persistently, which is also new. The reduced risk of getting hacked, the speed of doing everything locally, the cost effectiveness, there‚Äôs a lot to be excited about.</p>
<p>This is sounding kind of pitch-y, which I didn‚Äôt intend it to be, so I‚Äôll admit that this was not easy to accomplish, and introduced a boatload of technical complexity to Tome. Here‚Äôs a shortlist of problems tackled when building this:</p>
<ol><li>Making exports and imports performant - Tome uses concurrency (not serial Drupal-style batching), so I had to build a content dependency tree, sort it, and figure out what can be imported concurrently without causing errors. For example, you can usually import all files concurrently, but you can‚Äôt import a node before importing the file it references.</li>
<li>Removing entity IDs from exports - if two content editors are working on two branches, they‚Äôre bound to create entities with the same ID. Tome converts all entity IDs to UUIDs, which prevents these collisions, but required a lot of custom Normalizers.</li>
<li>Supporting multilingual - this is always hard to accomplish, and for Tome it was no different. But it works now!</li>
</ol><p>At the end of the day, even with all the insane code it took to get static content working, I‚Äôm glad I pushed through and got it running. Users are already coming up with ways to use this feature that I never thought of, like using the exported JSON in GatsbyJS to build HTML super-duper-fast, and I‚Äôm excited to see people continue to try it out (as long as you share what you‚Äôre doing with me!).</p>
<h2 id="realizing-that-multiple-audiences-exist">Realizing that multiple audiences exist.</h2>
<p>After I got the static content portion of Tome working, I started to talk to other developers and site maintainers about what I was doing, and quickly realized that there are really three distinct audiences for Tome:</p>
<ol><li>I want to build my site from scratch config, content, and files, then generate static HTML locally or on a CI like Netlify (this was my original vision for Tome).</li>
<li>I like having my content editors log into a central site, and just want Tome to generate static HTML.</li>
<li>I want to build my site from scratch or archive it with Tome, and don‚Äôt care about static HTML.</li>
</ol><p>I was really not ready for this feedback at the time. In my head everyone would have the same needs as me, but in reality people are unpredictable, and Drupal site maintainers like the way things work now, they just don‚Äôt like that production is slow, insecure, and expensive. This feedback was tough to take, but I realized that I needed to find a solution that works for everyone.</p>
<p>In the context of these audiences, I decided that Tome should be split into two sub-modules:</p>
<ul><li>Tome Sync - Automatically sync content, config, and file changes to your filesystem, and rebuild Drupal from scratch.</li>
<li>Tome Static - Generate Static HTML for your Drupal site.</li>
</ul><p>With this re-architecture, users could choose the parts of Tome they want, without being locked into the entire suite. Good for the user, a little tough for me (as it often is).</p>
<h2 id="static-html-it-just-works-right">Static HTML, it just works right?</h2>
<p>Tome Static was also complicated to develop, but is a lot less interesting to talk about than Tome Sync. When users generate static HTML with Tome, they just expect it to work, there isn‚Äôt a gradient of acceptability there.</p>
<p>The hardest part of Tome Static for me was making it fast. Really, really fast. Like Tome Sync, there were many technical problems to solve, namely:</p>
<ol><li>Getting a list of all paths on your site - Tome gets this list by loading all content entities and routes, which I think is obvious to most people, but what if you have thousands of content entities? I can‚Äôt rightfully load them all without running out of memory, so I had to design a path placeholder system that allows entity paths to be lazy-loaded at request time. I also had to support multilingual - that means loading every translation of every content entity, and prefixing every route with every language URL prefix. This is a great example of a problem that seems simple at first, but turns into a huge headache at scale.</li>
<li>Processing multiple requests in one Drupal bootstrap - This is something Drupal doesn‚Äôt normally do, but should be possible now that we‚Äôre using Symfony‚Äôs HttpKernel component. In practice there are a number of technical problems Tome has to overcome, usually related to core and contrib assuming that they can statically cache information that‚Äôs request dependent. I wouldn‚Äôt be surprised if bug reports related to this come in after the beta releases, but we need to process as many paths per bootstrap as possible to speed up build times.</li>
<li>Caching - Like the Page Cache module, Tome Static implements its own cache backend that helps determine what paths need to be re-generated. It took me a long time to find a good way to implement this, and in the end I just went with core‚Äôs cache APIs. It would have been extremely hard to accomplish Tome‚Äôs caching if I wasn‚Äôt using Drupal 8 (great job, everyone!).</li>
</ol><p>As I mentioned before, users don‚Äôt really care how hard this part of Tome was to build, they just expect it to work. That‚Äôs a good thing! It‚Äôs easier to solve problems for me if it‚Äôs obvious when what I‚Äôm doing doesn‚Äôt work.</p>
<h2 id="im-not-done-yet">I‚Äôm not done yet!</h2>
<p>Even though I‚Äôve done on a lot to get here, I already know there‚Äôs so much more for Tome to accomplish. While the first few betas will be about making what Tome does today better, I think the biggest tasks going forward are related to training, documentation, and marketing. A shortlist for me is:</p>
<ul><li>Document the beta release (I‚Äôm behind on this!).</li>
<li>Documenting how search and forms can work with a static Drupal site.</li>
<li>Figure out what a secure edit domain looks like when only using Tome Static - this may involve working with Drupal hosting providers and documenting a DIY approach.</li>
<li>Making Tome‚Äôs integration with static hosting platforms like Netlify richer - for example, I want to ship an example project that uses AWS Lambda to provide dynamic experiences while running Drupal statically.</li>
<li>Think of what using Tome Sync by itself looks like - what are the use cases, who is the audience? This isn‚Äôt completely clear to me right now.</li>
<li>Revamping¬†<a href="https://tome.fyi/">https://tome.fyi</a>¬†to look better (I‚Äôm not a designer, sorry!) and show off more of what Tome can do.</li>
</ul><p>For now, for anyone who made it to the bottom of the post, I would suggest reading through¬†<a href="https://tome.fyi/docs/getting-started">the getting started guide</a>¬†and trying out Tome for yourself.</p>
<p>I‚Äôm relying on users to come up with the really cool stuff for Tome, and want to develop in the direction you‚Äôre all heading with static Drupal. Make me proud!</p>
</div>
      
    </div>
  </article>

  </div>

</main>
  <footer class="mc-footer container">
    <ul class="mc-footer__menu">
      <li><a href="/search">Search</a></li>
      <li><a href="/blog">Blog</a></li>
      <li><a href="/work">Work</a></li>
      <li><a href="/gallery">Gallery</a></li>
      <li><a href="mailto:samuel@mortenson.coffee">Contact</a></li>
    </ul>
    <div class="mc-footer__copyright">¬©2020 Samuel Mortenson</div>
    <a class="mc-footer__rss" href="/feed.xml">
      <span class="visually-hidden">RSS Feed</span>
      <img alt="RSS feed icon" src="/core/misc/feed.svg" />
    </a>
  </footer>
  </div>

    
    
  </body>
</html>
